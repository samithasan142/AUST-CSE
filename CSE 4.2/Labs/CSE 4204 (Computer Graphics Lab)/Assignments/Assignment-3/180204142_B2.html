<html>
	<title> 180204142 (Assignment 3) </title>
	<canvas id = "canvas" width = "500" height = "500"> </canvas>
	
	<script>
		var canvas = document.getElementById("canvas");
		var gl = canvas.getContext("webgl");
		
		var vSS =
		`
			attribute vec3 a_coords;
			attribute vec3 a_colors;
			uniform mat4 u_RotX, u_RotY, u_Scale;			
			varying vec3 v_colors;
			
			void main()
			{
				gl_Position = u_RotX * u_RotY * u_Scale * vec4(a_coords, 1.0);
				v_colors = a_colors;
			}`;
		
		var fSS = 
		`
			precision mediump float;
			varying vec3 v_colors;
			void main()
			{
				gl_FragColor = vec4(v_colors, 1.0);
			}`;
		
		var vsh = gl.createShader(gl.VERTEX_SHADER);
		gl.shaderSource(vsh, vSS);
		gl.compileShader(vsh);
		
		var fsh = gl.createShader(gl.FRAGMENT_SHADER);
		gl.shaderSource(fsh, fSS);
		gl.compileShader(fsh);
		
		var prog = gl.createProgram();
		gl.attachShader(prog, vsh);
		gl.attachShader(prog, fsh);
		gl.linkProgram(prog);
		gl.useProgram(prog);
		
		var a_coords_location = gl.getAttribLocation(prog, "a_coords");
		var coords = new Float32Array([
						//front faces
						 0.0, 0.0, 0.5,
						 0.0, 0.5, 0.0,
						-0.5, 0.0, 0.0,
						 
						 0.0, 0.5, 0.0,
						 0.0, 0.0, 0.5,
						 0.5, 0.0, 0.0,
						 
						 0.0, 0.0, 0.5,
						 0.0,-0.5, 0.0,
						 0.5, 0.0, 0.0,
						 
						 0.0, 0.0, 0.5,
						-0.5, 0.0, 0.0,
						 0.0,-0.5, 0.0,
						
						//back faces
						 0.0, 0.5, 0.0,
						 0.0, 0.0,-0.5,
						-0.5, 0.0, 0.0,
						
						 0.0, 0.0,-0.5,
						 0.0, 0.5, 0.0,
						 0.5, 0.0, 0.0,
						 
						 0.0,-0.5, 0.0,
						 0.0, 0.0,-0.5,
						 0.5, 0.0, 0.0,
						 
						 0.0, 0.0,-0.5,
						 0.0,-0.5, 0.0,
						-0.5, 0.0, 0.0
					 ]);
					 
		var a_colors_location = gl.getAttribLocation(prog, "a_colors");
		var colors = new Float32Array([
						0.0, 1.0, 0.0,
						0.0, 1.0, 0.0,
						0.0, 1.0, 0.0,
						
						0.0, 1.0, 1.0,
						0.0, 1.0, 1.0,
						0.0, 1.0, 1.0,
						
						1.0, 0.0, 0.0,
						1.0, 0.0, 0.0,
						1.0, 0.0, 0.0,
						
						0.0, 0.0, 1.0,
						0.0, 0.0, 1.0,
						0.0, 0.0, 1.0,
						
						
						1.0, 0.5, 0.0,
						1.0, 0.5, 0.0,
						1.0, 0.5, 0.0,
						
						0.0, 0.0, 0.0,
						0.0, 0.0, 0.0,
						0.0, 0.0, 0.0,
						
						1.0, 0.0, 1.0,
						1.0, 0.0, 1.0,
						1.0, 0.0, 1.0,
						
						1.0, 1.0, 0.0,
						1.0, 1.0, 0.0,
						1.0, 1.0, 0.0
					 ]);
					 
		var indices = new Uint8Array([
						0,1,2,
						3,4,5,
						6,7,8,
						9,10,11,
						
						12,13,14,
						15,16,17,
						18,19,20,
						21,22,23
					  ]);
					
		//BUFFERS
		var a_coords_buffer = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, a_coords_buffer);
		gl.bufferData(gl.ARRAY_BUFFER, coords, gl.STATIC_DRAW);
		gl.vertexAttribPointer(a_coords_location, 3, gl.FLOAT, false, 0, 0);
		gl.enableVertexAttribArray(a_coords_location);
		
		var a_colors_buffer = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, a_colors_buffer);
		gl.bufferData(gl.ARRAY_BUFFER, colors, gl.STATIC_DRAW);
		gl.vertexAttribPointer(a_colors_location, 3, gl.FLOAT, false, 0, 0);
		gl.enableVertexAttribArray(a_colors_location);
		
		var ind_buffer = gl.createBuffer();
		gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ind_buffer);
		gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);
		
		//FUNCTIONS
		function computeRotX(thetaX)
		{
			var rad = thetaX*Math.PI/180;
			var rotateXMatrix = new Float32Array([
								1.0,            0.0,           0.0, 0.0,
								0.0,  Math.cos(rad), Math.sin(rad), 0.0,
								0.0, -Math.sin(rad), Math.cos(rad), 0.0,
								0.0,            0.0,           0.0, 1.0
							]);
			return rotateXMatrix;
		}
		
		function computeRotY(thetaY)
		{
			var rad = thetaY*Math.PI/180;
			var rotateYMatrix = new Float32Array([
								Math.cos(rad), 0.0, -Math.sin(rad), 0.0,
								          0.0, 1.0,            0.0, 0.0,
								Math.sin(rad), 0.0,  Math.cos(rad), 0.0,
								          0.0, 0.0,            0.0, 1.0
							]);
			return rotateYMatrix;
		}
		
		function computeScale(x, y, z)
		{
			
			var scaleMatrix = new Float32Array([
								  x, 0.0, 0.0, 0.0,
								0.0,   y, 0.0, 0.0,
								0.0, 0.0,   z, 0.0,
								0.0, 0.0, 0.0, 1.0
							]);
			return scaleMatrix;
		}
		
		//TRANSFORMATIONS
		var u_RotX_location = gl.getUniformLocation(prog, "u_RotX");
		var u_RotY_location = gl.getUniformLocation(prog, "u_RotY");
		var u_scale_location = gl.getUniformLocation(prog, "u_Scale");
		var sX = 1;
		var sY = 1;
		var sZ = 1;
		var thetaX = 0;
		var thetaY = 0;
		
		rotX_Mat = computeRotX(thetaX);
		rotY_Mat = computeRotY(thetaY);
		scale_Mat = computeScale(sX, sY, sZ);
		
		gl.uniformMatrix4fv(u_scale_location, false, scale_Mat);
		gl.uniformMatrix4fv(u_RotX_location, false, rotX_Mat);
		gl.uniformMatrix4fv(u_RotY_location, false, rotY_Mat);
		
				
		var inc = 1.0
		document.querySelector("body").onkeydown = function(e)
		{
			if(e.key === "w")
				thetaX -= inc;
			else if(e.key ==="z")
				thetaX += inc;
			else if(e.key === "a")
				thetaY -= inc;
			else if(e.key ==="s")
				thetaY += inc;
			else if(e.key ==="+")
			{
				sX += 0.1;
				sY += 0.1;
				sZ += 0.1;
			}
			else if(e.key ==="-")
			{
				sX -= 0.1;
				sY -= 0.1;
				sZ -= 0.1;
			}
			else
				console.log(e);
			
			rotX_Mat = computeRotX(thetaX);
			rotY_Mat = computeRotY(thetaY);
			scale_Mat = computeScale(sX, sY, sZ);
			
			gl.uniformMatrix4fv(u_scale_location, false, scale_Mat);
			gl.uniformMatrix4fv(u_RotX_location, false, rotX_Mat);
			gl.uniformMatrix4fv(u_RotY_location, false, rotY_Mat);
			
			gl.clearColor(1,1,1,1);
			gl.enable(gl.DEPTH_TEST);
			gl.enable(gl.CULL_FACE);
			gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
		
			//gl.drawArrays(gl.TRIANGLES, 0, 3);
			gl.drawElements(gl.TRIANGLES, 3 * 8, gl.UNSIGNED_BYTE, 0);
		}
		gl.clearColor(1,1,1,1);
		gl.enable(gl.DEPTH_TEST);
		gl.enable(gl.CULL_FACE);
		gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
		gl.drawElements(gl.TRIANGLES, 3 * 8, gl.UNSIGNED_BYTE, 0);
	</script>
</html>